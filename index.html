<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°¥ì¤˜ AI - ë©”ë‰´ ì¶”ì²œ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>ğŸš ë°¥ì¤˜ AI</h1>
            <p>ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ë”± ì •í•´ë“œë¦½ë‹ˆë‹¤!</p>
        </header>

        <div class="card">
            <div class="step-group">
                <h3><i class="fa-solid fa-utensils"></i> ë©”ë‰´ ì¢…ë¥˜</h3>
                <div class="button-group" id="category-group">
                    <button type="button" class="select-btn" data-value="í•œì‹">ğŸš í•œì‹</button>
                    <button type="button" class="select-btn" data-value="ì¤‘ì‹">ğŸœ ì¤‘ì‹</button>
                    <button type="button" class="select-btn" data-value="ì¼ì‹">ğŸ£ ì¼ì‹</button>
                    <button type="button" class="select-btn" data-value="ì–‘ì‹">ğŸ ì–‘ì‹</button>
                    <button type="button" class="select-btn" data-value="ë¶„ì‹">ë–¡ë³¶ì´</button>
                    <button type="button" class="select-btn" data-value="ê¸°íƒ€">ğŸŒ® ê¸°íƒ€</button>
                </div>
                <input type="hidden" id="category" required>
            </div>

            <div class="step-group">
                <h3><i class="fa-solid fa-user"></i> ì—°ë ¹ëŒ€</h3>
                <div class="button-group" id="age-group">
                    <button type="button" class="select-btn" data-value="10s">10ëŒ€</button>
                    <button type="button" class="select-btn" data-value="20s">20ëŒ€</button>
                    <button type="button" class="select-btn" data-value="30s">30ëŒ€</button>
                    <button type="button" class="select-btn" data-value="40s">40ëŒ€+</button>
                </div>
                <input type="hidden" id="age" required>
            </div>

            <div class="step-group">
                <h3><i class="fa-solid fa-wallet"></i> ì˜ˆì‚°</h3>
                <div class="button-group" id="budget-group">
                    <button type="button" class="select-btn" data-min="0" data-max="10000">ğŸ’¸ 1ë§Œì› ì´í•˜</button>
                    <button type="button" class="select-btn" data-min="10000" data-max="20000">ğŸ’° 1~2ë§Œì›</button>
                    <button type="button" class="select-btn" data-min="20000" data-max="1000000">ğŸ’³ 2ë§Œì› ì´ˆê³¼</button>
                </div>
                <input type="hidden" id="min-price">
                <input type="hidden" id="max-price">
            </div>

            <button id="submit-btn" class="submit-btn" disabled>ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
        </div>

        <div id="result-area" class="hidden">
            <div id="loading" class="hidden">
                <div class="spinner">ğŸ”</div>
                <p>AIê°€ ë§›ì§‘ì„ ì°¾ê³  ìˆì–´ìš”...</p>
            </div>
            <div id="result-content" class="hidden"></div>
        </div>
    </div>

    <script>
        // ğŸ‘‡ ì—¬ê¸°ì— ì›¹í›… ì£¼ì†Œ ê¼­ ë„£ìœ¼ì„¸ìš”!
        const WEBHOOK_URL = 'https://hook.us2.make.com/ncvur1c9cqvhv8lh58iyjg4o8ajfyx9r';

        document.querySelectorAll('.button-group').forEach(group => {
            group.addEventListener('click', (e) => {
                if (e.target.classList.contains('select-btn')) {
                    group.querySelectorAll('.select-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');

                    if (group.id === 'budget-group') {
                        document.getElementById('min-price').value = e.target.dataset.min;
                        document.getElementById('max-price').value = e.target.dataset.max;
                    } else {
                        const inputId = group.id.replace('-group', '');
                        document.getElementById(inputId).value = e.target.dataset.value;
                    }
                    checkAllSelected();
                }
            });
        });

        function checkAllSelected() {
            const category = document.getElementById('category').value;
            const age = document.getElementById('age').value;
            const minPrice = document.getElementById('min-price').value;
            
            if (category && age && minPrice) {
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('submit-btn').classList.add('ready');
            }
        }

        document.getElementById('submit-btn').addEventListener('click', async () => {
            const resultArea = document.getElementById('result-area');
            const loading = document.getElementById('loading');
            const resultContent = document.getElementById('result-content');

            resultArea.classList.remove('hidden');
            loading.classList.remove('hidden');
            resultContent.classList.add('hidden');
            resultArea.scrollIntoView({ behavior: 'smooth' });

            const formData = {
                category: document.getElementById('category').value,
                age: document.getElementById('age').value,
                // ì—¬ê¸°ì„œ ìˆ«ìë¡œ ë³€í™˜í•´ì„œ ë³´ëƒ…ë‹ˆë‹¤!
                min_price: parseInt(document.getElementById('min-price').value),
                max_price: parseInt(document.getElementById('max-price').value)
            };

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                loading.classList.add('hidden');
                resultContent.classList.remove('hidden');

                if (data.recommendation && data.recommendation.Menu_Name) {
                    const menu = data.recommendation;
                    resultContent.innerHTML = `
                        <div class="success-card">
                            <div class="badge">${menu.Category}</div>
                            <h2>${menu.Menu_Name}</h2>
                            <p class="price">${menu.Price.toLocaleString()}ì›</p>
                            <div class="tags">
                                <span>#${menu.Recommended_Age}ì¶”ì²œ</span>
                                <span>#${menu.Category}ë§›ì§‘</span>
                            </div>
                        </div>
                        <button onclick="location.reload()" class="retry-btn">ë‹¤ì‹œ ì¶”ì²œë°›ê¸°</button>
                    `;
                } else {
                    resultContent.innerHTML = `<p class="error">ğŸ˜¢ ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ê°€ ì—†ì–´ìš”.</p><button onclick="location.reload()" class="retry-btn">ë‹¤ì‹œí•˜ê¸°</button>`;
                }
            } catch (error) {
                console.error(error);
                loading.classList.add('hidden');
                resultContent.innerHTML = `<p class="error">ğŸš¨ ì˜¤ë¥˜ê°€ ë‚¬ì–´ìš”!</p>`;
            }
        });
    </script>
</body>
</html>
